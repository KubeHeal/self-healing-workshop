= Self-Healing Workshop
:toc: left
:toclevels: 3

== Overview

This workshop demonstrates the **OpenShift AI Ops Self-Healing Platform** - an AI-powered self-healing solution for OpenShift clusters that combines deterministic automation with machine learning for intelligent incident response.

=== Workshop Modules

[cols="1,3"]
|===
|Module |Description

|**Module 0**
|Introduction & Architecture - How the platform works

|**Module 1**
|ML Model Training with Tekton - Train anomaly detection models

|**Module 2**
|Deploy MCP Server & Configure Lightspeed - Setup required for demos _(Required)_

|**Module 3**
|End-to-End Self-Healing with Lightspeed - Interactive AI-powered cluster management

|**Module 4**
|Extra Credit - Advanced ML (LSTM, ensemble) and custom model deployment

|**Module 5**
|Notebook Catalog & Use Cases - Guide to 33+ Jupyter notebooks
|===

=== Prerequisites

* OpenShift 4.18+ cluster with admin access
* Red Hat Demo Platform AWS sandbox (recommended)
* LLM API key (OpenAI, Google Gemini, or Anthropic)

== Project Status

[WARNING]
====
**üöß IN DEVELOPMENT** - This repository is actively under development and not yet ready for production use.

**Current State:**
- Core workshop content and modules are complete
- Deployment automation is being tested and validated
- Integration points are being refined

**Deployment Strategy:**
- **Primary Direction**: AgnosticD V2 deployment (optimized for Red Hat Demo Platform and end-user workshops)
- **Validation In Progress**: Testing integration with the https://github.com/KubeHeal/openshift-aiops-platform[OpenShift AI Ops Platform] fork-and-deploy workflow for development use cases
- **Multiple Deployment Paths**: Choose based on your use case:
  - Developers: Option 1 (Fork and Deploy) provides full control and customization
  - End Users/Workshop Participants: Option 2 (AgnosticD) provides automated, managed deployment
====

== Deployment Options

=== Option 1: Fork and Deploy (Recommended for Development)

**Use this option if you:**
- Want full control over the platform deployment
- Need to customize values files or Helm charts
- Are developing or testing platform features
- Prefer manual step-by-step deployment

This deployment method uses the comprehensive instructions from the main OpenShift AI Ops Platform repository.

==== Prerequisites

- OpenShift 4.18+ cluster with admin access
- Local workstation with:
  - `podman` - Container runtime
  - `oc`, `kubectl`, `helm` - Kubernetes CLIs
  - `ansible-navigator` - Ansible execution environment runner
- Red Hat Ansible Automation Hub token (https://console.redhat.com/ansible/automation-hub/token[get one here])
- Red Hat registry credentials (https://access.redhat.com/terms-based-registry/[get credentials here])

==== Key Steps Overview

[IMPORTANT]
====
**Critical Configuration:** You must fork the repository and update Git URLs in values files, or ArgoCD will fail to sync.
====

1. **Fork the repository** on GitHub:
   - Navigate to https://github.com/KubeHeal/openshift-aiops-platform
   - Click "Fork" to create your own copy

2. **Clone YOUR fork**:
   ```bash
   git clone https://github.com/YOUR-USERNAME/openshift-aiops-platform.git
   cd openshift-aiops-platform
   ```

3. **Update Git repository URLs** (CRITICAL):
   - Edit `values-global.yaml` (line 98) - Update `git.repoURL` to YOUR fork URL
   - Edit `values-hub.yaml` (line 57) - Update `repoURL` to YOUR fork URL

   ```bash
   vi values-global.yaml
   # Change: repoURL: "https://gitea-with-admin-gitea.apps.cluster-pvbs6..."
   # To:     repoURL: "https://github.com/YOUR-USERNAME/openshift-aiops-platform.git"

   vi values-hub.yaml
   # Change: repoURL: "https://gitea-with-admin-gitea.apps.cluster-pvbs6..."
   # To:     repoURL: "https://github.com/YOUR-USERNAME/openshift-aiops-platform.git"
   ```

4. **Set Ansible Hub token and build execution environment**:
   ```bash
   export ANSIBLE_HUB_TOKEN='your-token-here'
   podman login registry.redhat.io
   make build-ee
   ```

5. **Deploy the platform**:
   ```bash
   make check-prerequisites
   make operator-deploy-prereqs
   make operator-deploy
   make argo-healthcheck
   ```

==== Expected Outcome

After successful deployment, you'll have:
- ‚úÖ Self-healing platform deployed in `self-healing-platform` namespace
- ‚úÖ ArgoCD managing GitOps deployments
- ‚úÖ Coordination engine and MCP server running
- ‚úÖ KServe ML models (anomaly-detector, predictive-analytics)
- ‚úÖ Jupyter workbench running in OpenShift AI for notebook development
- ‚úÖ OpenShift Lightspeed integration (if configured)

==== Complete Instructions

For detailed step-by-step instructions, troubleshooting, and advanced configuration options, see:

**üìñ https://github.com/KubeHeal/openshift-aiops-platform#option-1-fork-and-deploy-recommended-for-development[OpenShift AI Ops Platform - Fork and Deploy Guide]**

=== Option 2: AgnosticD V2 Deployment (Recommended for End Users)

**Use this option if you:**
- Are participating in a workshop or training
- Want automated, managed deployment
- Are using Red Hat Demo Platform sandboxes
- Prefer a streamlined deployment with minimal manual steps

The workshop includes an AgnosticD V2 workload that automatically deploys the entire self-healing platform using a pre-built execution environment.

[NOTE]
====
**For Advanced AgnosticD Users:** Complete AgnosticD V2 setup and configuration documentation is available at:
https://raw.githubusercontent.com/agnosticd/agnosticd-v2/refs/heads/main/docs/setup.adoc[AgnosticD V2 Setup Guide]
====

==== Step 1: Clone AgnosticD V2

If you don't have AgnosticD V2 installed, clone it first:

[source,bash]
----
# Clone AgnosticD V2
git clone https://github.com/agnosticd/agnosticd-v2.git ~/agnosticd-v2
cd ~/agnosticd-v2

# Create vars directory for your configurations
mkdir -p ~/agnosticd-v2-vars
----

==== Step 2: Set Up Workshop Configuration

[source,bash]
----
# Clone the workshop repository
git clone https://github.com/KubeHeal/self-healing-workshop.git ~/self-healing-workshop

# Copy the workshop vars file to AgnosticD V2 vars directory
cp ~/self-healing-workshop/agnosticd/vars/self-healing-workshop.yml ~/agnosticd-v2-vars/

# Edit the vars file to configure your environment
vi ~/agnosticd-v2-vars/self-healing-workshop.yml
----

==== Step 3: Configure Cluster Credentials

Edit `~/agnosticd-v2-vars/self-healing-workshop.yml` and update:

[source,yaml]
----
clusters:
- default:
    api_url: "https://api.YOUR_CLUSTER.example.com:6443"
    api_token: "sha256~YOUR_TOKEN_HERE"

# LLM Provider (choose one)
self_healing_platform_llm_provider: "openai"  # or "gemini", "anthropic"
----

==== Step 4: Provision the Workshop

[source,bash]
----
cd ~/agnosticd-v2

# Provision the workshop environment
./bin/agd provision -g workshop1 -c self-healing-workshop -a YOUR_SANDBOX_NAME
----

==== What Gets Deployed

The AgnosticD workload automatically deploys:

* ‚úÖ Validated Patterns Operator (GitOps deployment framework)
* ‚úÖ Self-Healing Platform components (coordination engine, MCP server)
* ‚úÖ KServe ML models for anomaly detection
* ‚úÖ OpenShift AI with Jupyter workbench containing all workshop notebooks
* ‚úÖ OpenShift Lightspeed operator (optional AI assistant)
* ‚úÖ ArgoCD application for continuous GitOps sync

==== Post-Deployment Steps

After deployment completes, you'll need to:

1. **Create LLM API key secret** (if using OpenShift Lightspeed):
   ```bash
   oc create secret generic openai-credentials \
     -n openshift-lightspeed \
     --from-literal=api_key='your-api-key-here'
   ```

2. **Validate deployment**:
   ```bash
   # Use the workshop validation script
   ~/self-healing-workshop/scripts/validate-workshop.sh
   ```

3. **Access Jupyter notebooks in OpenShift AI**:
   ```bash
   # Get the OpenShift AI dashboard URL
   oc get route rhods-dashboard -n redhat-ods-applications -o jsonpath='{.spec.host}'

   # Or access workbench directly via port-forward (for development)
   oc port-forward self-healing-workbench-0 8888:8888 -n self-healing-platform
   # Open http://localhost:8888
   ```

== Access the Workshop

=== Online (GitHub Pages)

The workshop is published at:

**https://kubeheal.github.io/self-healing-workshop/**

=== Local Preview

[source,bash]
----
# Clone repository
git clone https://github.com/KubeHeal/self-healing-workshop.git
cd self-healing-workshop

# Using Podman (recommended)
podman run --rm --name antora -v $PWD:/antora:z -p 8080:8080 ghcr.io/juliaaano/antora-viewer

# Open http://localhost:8080/modules/index.html in your browser
----

=== Build Static HTML

[source,bash]
----
podman run --rm -v $PWD:/antora:z ghcr.io/juliaaano/antora-viewer antora default-site.yml
# Output in ./www/
----

== Workshop Structure

[source]
----
self-healing-workshop/
‚îú‚îÄ‚îÄ README.adoc                    # This file
‚îú‚îÄ‚îÄ site.yml                       # Antora site configuration
‚îú‚îÄ‚îÄ default-site.yml               # Default Antora playbook
‚îú‚îÄ‚îÄ content/
‚îÇ   ‚îú‚îÄ‚îÄ antora.yml                 # Workshop attributes
‚îÇ   ‚îî‚îÄ‚îÄ modules/ROOT/
‚îÇ       ‚îú‚îÄ‚îÄ nav.adoc               # Navigation
‚îÇ       ‚îî‚îÄ‚îÄ pages/
‚îÇ           ‚îú‚îÄ‚îÄ index.adoc         # Welcome & prerequisites
‚îÇ           ‚îú‚îÄ‚îÄ module-00.adoc     # Introduction & Architecture
‚îÇ           ‚îú‚îÄ‚îÄ module-01.adoc     # ML Model Training with Tekton
‚îÇ           ‚îú‚îÄ‚îÄ module-02.adoc     # Deploy MCP Server & Configure Lightspeed
‚îÇ           ‚îú‚îÄ‚îÄ module-03.adoc     # End-to-End Self-Healing
‚îÇ           ‚îú‚îÄ‚îÄ module-04.adoc     # Extra Credit - Advanced ML
‚îÇ           ‚îî‚îÄ‚îÄ module-05.adoc     # Notebook Catalog & Use Cases
‚îú‚îÄ‚îÄ agnosticd/
‚îÇ   ‚îú‚îÄ‚îÄ vars/                      # AgnosticD variables template
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ self-healing-workshop.yml
‚îÇ   ‚îî‚îÄ‚îÄ workload/                  # AgnosticD workload role
‚îÇ       ‚îî‚îÄ‚îÄ ocp4_workload_self_healing_platform/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ deploy-pages.yml       # GitHub Pages deployment
‚îî‚îÄ‚îÄ scripts/
    ‚îî‚îÄ‚îÄ validate-workshop.sh       # Workshop validation
----

== Resources

=== KubeHeal Repositories

* https://github.com/KubeHeal/openshift-aiops-platform[OpenShift AI Ops Platform] - Main platform
* https://github.com/KubeHeal/openshift-cluster-health-mcp[Cluster Health MCP Server] - MCP Server (Go)
* https://github.com/KubeHeal/openshift-coordination-engine[Coordination Engine] - Remediation orchestration (Go)

=== External Documentation

* https://github.com/agnosticd/agnosticd-v2[AgnosticD V2] - Deployment framework
* https://docs.openshift.com/container-platform/latest/lightspeed/[OpenShift Lightspeed] - AI assistant
* https://modelcontextprotocol.io/[Model Context Protocol (MCP)] - AI tool integration
* https://kserve.github.io/website/[KServe] - Model serving

== License

GNU General Public License v3.0

== Contributing

Contributions welcome! Please open an issue or PR.

---

**Made with ‚ù§Ô∏è by the KubeHeal community**
